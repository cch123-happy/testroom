<!DOCTYPE html>
<html>
<head>
    <title>聊天室</title>
    <style>
        #messages { height: 300px; border: 1px solid #ccc; overflow-y: scroll; }
    </style>
</head>
<body>
    <h1>FastAPI 聊天室</h1>
    
    <!-- 1. 用户名输入区 -->
    <div id="login">
        <input type="text" id="username" placeholder="输入你的名字" />
        <button onclick="connect()">加入聊天</button>
    </div>

    <!-- 2. 聊天区（默认隐藏） -->
    <div id="chat" style="display:none">
        <div id="messages"></div>
        <input type="text" id="message" placeholder="输入消息" />
        <button onclick="send()">发送</button>
    </div>

    <script>
        let ws;
      
        function connect() {
          const username = document.getElementById("username").value;
          if (!username) return alert("请输入名字！");
      
          // 使用免费 WebSocket 测试服务（示例）
          ws = new WebSocket("wss://ws.postman-echo.com/raw");
      
          ws.onmessage = (event) => {
            const messages = document.getElementById("messages");
            // 测试服务会原样返回消息，这里加上用户名
            messages.innerHTML += `<div>${username}: ${event.data}</div>`;
            messages.scrollTop = messages.scrollHeight;
          };
      
          ws.onopen = () => {
            // 连接成功后发送一条欢迎消息
            ws.send(`${username} 加入了聊天`);
            document.getElementById("login").style.display = "none";
            document.getElementById("chat").style.display = "block";
          };
      
          ws.onerror = (error) => {
            console.error("WebSocket 错误:", error);
            alert("连接测试服务失败，请换一个地址或稍后再试。");
          };
        }
      
        function send() {
          const message = document.getElementById("message").value;
          if (!message || !ws) return;
          ws.send(message);
          document.getElementById("message").value = "";
        }
      </script>
</body>
</html>